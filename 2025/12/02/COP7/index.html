<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="rippor">
    
    <!-- Completely eliminate flash of wrong theme -->
    <script>
        (function() {
            const THEME_KEY = "REDEFINE-THEME-STATUS";
            const DARK = "dark", LIGHT = "light";
            
            // Get preferred theme
            function getTheme() {
                try {
                    const saved = localStorage.getItem(THEME_KEY);
                    if (saved) {
                        const { isDark } = JSON.parse(saved);
                        return isDark ? DARK : LIGHT;
                    }
                } catch (e) {}
                
                return matchMedia("(prefers-color-scheme: dark)").matches ? DARK : LIGHT;
            }
            
            // Apply theme to document
            function applyTheme(theme) {
                const isDark = theme === DARK;
                const root = document.documentElement;
                
                // Set data attribute for CSS variables
                root.setAttribute("data-theme", theme);
                
                // Set classes for compatibility
                root.classList.add(theme);
                root.classList.remove(isDark ? LIGHT : DARK);
                root.style.colorScheme = theme;
            }
            
            // Initial application
            const theme = getTheme();
            applyTheme(theme);
            
            // Listen for system preference changes
            matchMedia("(prefers-color-scheme: dark)").addEventListener("change", ({ matches }) => {
                // Only update if using system preference (no localStorage entry)
                if (!localStorage.getItem(THEME_KEY)) {
                    applyTheme(matches ? DARK : LIGHT);
                }
            });
            
            // Set body classes once DOM is ready
            if (document.readyState !== "loading") {
                document.body.classList.add(theme + "-mode");
            } else {
                document.addEventListener("DOMContentLoaded", () => {
                    document.body.classList.add(theme + "-mode");
                    document.body.classList.remove((theme === DARK ? LIGHT : DARK) + "-mode");
                });
            }
        })();
    </script>
    
    <!-- Critical CSS to prevent flash -->
    <style>
        :root[data-theme="dark"] {
            --background-color: #202124;
            --background-color-transparent: rgba(32, 33, 36, 0.6);
            --second-background-color: #2d2e32;
            --third-background-color: #34353a;
            --third-background-color-transparent: rgba(32, 33, 36, 0.6);
            --primary-color: #0066CC;
            --first-text-color: #ffffff;
            --second-text-color: #eeeeee;
            --third-text-color: #bebec6;
            --fourth-text-color: #999999;
            --default-text-color: #bebec6;
            --invert-text-color: #373D3F;
            --border-color: rgba(255, 255, 255, 0.08);
            --selection-color: #0066CC;
            --shadow-color-1: rgba(255, 255, 255, 0.08);
            --shadow-color-2: rgba(255, 255, 255, 0.05);
        }
        
        :root[data-theme="light"] {
            --background-color: #fff;
            --background-color-transparent: rgba(255, 255, 255, 0.6);
            --second-background-color: #f8f8f8;
            --third-background-color: #f2f2f2;
            --third-background-color-transparent: rgba(241, 241, 241, 0.6);
            --primary-color: #0066CC;
            --first-text-color: #16171a;
            --second-text-color: #2f3037;
            --third-text-color: #5e5e5e;
            --fourth-text-color: #eeeeee;
            --default-text-color: #373D3F;
            --invert-text-color: #bebec6;
            --border-color: rgba(0, 0, 0, 0.08);
            --selection-color: #0066CC;
            --shadow-color-1: rgba(0, 0, 0, 0.08);
            --shadow-color-2: rgba(0, 0, 0, 0.05);
        }
        
        body {
            background-color: var(--background-color);
            color: var(--default-text-color);
        }
        
        /* Apply body classes as soon as DOM is ready */
        :root[data-theme="dark"] body {
            background-color: var(--background-color);
            color: var(--default-text-color);
        }
    </style>
    
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2025/12/02/cop7/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
        
        <meta name="description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:type" content="article">
<meta property="og:title" content="计组P7——流水线CPU（复杂指令集&amp;支持异常处理）">
<meta property="og:url" content="http://example.com/2025/12/02/COP7/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/redefine-og.webp">
<meta property="article:published_time" content="2025-12-02T02:12:46.000Z">
<meta property="article:modified_time" content="2025-12-15T14:20:25.962Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Verilog">
<meta property="article:tag" content="五层流水线CPU">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/redefine-og.webp">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/img/rippor.jpg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/rippor.jpg">
    <meta name="theme-color" content="#50808E">
    <link rel="shortcut icon" href="/img/rippor.jpg">
    <!--- Page Info-->
    
    <title>
        
            计组P7——流水线CPU（复杂指令集&amp;支持异常处理） | Adventure
        
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/css/build/tailwind.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"};
    window.theme = {"articles":{"style":{"font_size":"24px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":["null"]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#50808E","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1500px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"side_tools":{"gear_rotation":true,"auto_expand":false},"open_graph":{"enable":true,"image":"/images/redefine-og.webp","description":"Hexo Theme Redefine, Redefine Your Hexo Journey."},"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"Adventure","subtitle":{"text":["Never give up."],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"style":"default","links":{"github":"https://github.com/rippor911","instagram":null,"zhihu":null,"twitter":null,"email":null},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":true,"type":"fixed","audios":[{"name":"不再年轻的村庄 The Fading Stories","artist":"陈致逸,HOYO-MiX","url":"\\music\\陈致逸,HOYO-MiX - 不再年轻的村庄(轻策夜间) The Fading Stories (Qingce Night.mp3","cover":"\\img\\album\\璃月.jpg","lrc":null},{"name":"皎洁的笑颜 Moonlike Smile","artist":"陈致逸,HOYO-MiX","url":"\\music\\陈致逸,HOYO-MiX - 皎洁的笑颜 Moonlike Smile.mp3","cover":"\\img\\album\\雪山.jpg","lrc":null},{"name":"仙家独酌 Adeptus' Solace.mp3","artist":"陈致逸,HOYO-MiX","url":"\\music\\陈致逸,HOYO-MiX - 仙家独酌 Adeptus' Solace.mp3","cover":"\\img\\album\\璃月.jpg","lrc":null},{"name":"偷闲浮生 Adeptus' Retirement","artist":"陈致逸,HOYO-MiX","url":"\\music\\陈致逸,HOYO-MiX - 偷闲浮生 Adeptus' Retirement.mp3","cover":"\\img\\album\\璃月.jpg","lrc":null},{"name":"希望的明日 Another Hopeful Tomorrow","artist":"陈致逸,HOYO-MiX","url":"\\music\\陈致逸,HOYO-MiX - 希望的明日 Another Hopeful Tomorrow.mp3","cover":"\\img\\album\\璃月.jpg","lrc":null},{"name":"静夜的轻语 Silent Voices of the Night","artist":"HOYO-MiX","url":"\\music\\HOYO-MiX - 静夜的轻语 Silent Voices of the Night.mp3","cover":"\\img\\album\\纳塔.jpg","lrc":null},{"name":"我心孤云身野鹤 Thoughts Straying as Clouds","artist":"HOYO-MiX","url":"\\music\\HOYO-MiX - 我心孤云身野鹤 Thoughts Straying as Clouds.mp3","cover":"\\img\\album\\沉玉谷.jpg","lrc":null},{"name":"Ahead of Us","artist":"小瀬村晶","url":"\\music\\小瀬村晶 - Ahead of Us.mp3","cover":"\\img\\album\\于此处.jpg","lrc":null},{"name":"Sunshine","artist":"OneRepublic","url":"\\music\\OneRepublic - Sunshine.mp3","cover":null,"lrc":null},{"name":"需要人陪","artist":"王力宏","url":"\\music\\王力宏 - 需要人陪.mp3","cover":null,"lrc":null},{"name":"月光","artist":"胡彦斌# audio artist","url":"\\music\\胡彦斌 - 月光.mp3","cover":null,"lrc":null}]},"mermaid":{"enable":true,"version":"11.12.0"}},"version":"2.8.5","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Photo Gallery":{"path":"/masonry","icon":"fa-regular fa-chart-bar"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/rippor911"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","excerpt_length":50,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2025/9/26 17:31:27"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":true};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>



<body>
	<div class="progress-bar-container">
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
                <a class="logo-image h-8 w-8 sm:w-10 sm:h-10 mr-3" href="/">
                    <img src="/img/rippor.jpg" class="w-full h-full rounded-xs">
                </a>
            
            <a class="logo-title" href="/">
                
                Adventure
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    ARCHIVES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/masonry"
                                        >
                                    <i class="fa-regular fa-chart-bar fa-fw"></i>
                                    PHOTO GALLERY
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    ABOUT
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a href="/about">
                                                    ME
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/rippor911">
                                                    GITHUB
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                ARCHIVES
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/masonry"
                        >
                            <span>
                                PHOTO GALLERY
                            </span>
                            
                                <i class="fa-regular fa-chart-bar fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-About"
                        >
                            <span>
                                ABOUT
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-About">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/about">ME</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/rippor911">GITHUB</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/tags"
                        >
                            <span>Tags</span>
                            <i class="fa-regular fa-tags fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/categories"
                        >
                            <span>Categories</span>
                            <i class="fa-regular fa-folder fa-sm fa-fw"></i>
                        </a>
                    </li>
                
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">10</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">3</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">13</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">计组P7——流水线CPU（复杂指令集&amp;支持异常处理）</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/img/rippor.jpg">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">rippor</span>
					
					<span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">null</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-12-02 10:12:46</span>
        <span class="mobile">2025-12-02 10:12:46</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-12-15 22:20:25</span>
            <span class="mobile">2025-12-15 22:20:25</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/CO/">CO</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Verilog/">Verilog</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E4%BA%94%E5%B1%82%E6%B5%81%E6%B0%B4%E7%BA%BFCPU/">五层流水线CPU</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>4.1k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>16 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<h2 id="上级日记"><a href="#上级日记" class="headerlink" title="上级日记"></a>上级日记</h2><p>第一次没过强测，坐牢，所以建议第一次上机前要充分测试</p>
<p>第二次加指令没过，交了，感觉题目不复杂，错一个点（提示信息是expected 正常 but 进入4180），但是不想再坐牢了</p>
<p>描述是增加CP0[18]表示溢出判断使能，CP0[19]表示边界，add、addi、sub的结果如果绝对值大于这个边界(保证不大于0x7fff)，也算溢出</p>
<p>有几个模糊的点都尝试了：应该是只针对 add、addi、sub ，并且无论你是暴力阻塞还是对 CP0 转发应该都可以</p>
<p>关于绝对值的判断我是 abs = (out[31] == 1) ? ((~out) + 1) : out;</p>
<p>提出来是因为我不是很确定，但是后来和同学聊了之后这是能过的，不是这的问题</p>
<p>现在想来可能是一些很隐性的 bug ，没在强测里面体现出来，毕竟确实这题改的地方不多，我初版就是只改了 alu 和 cp0 ，然后把他俩连起来就完了，只错这一个点，后来又改成阻塞，还是没用，cp0 纯像个寄存器，alu 也陶腾了好几遍，感觉只能是别的问题了</p>
<p>总而言之，完结快乐</p>
<h2 id="设计草稿"><a href="#设计草稿" class="headerlink" title="设计草稿"></a>设计草稿</h2><table>
<thead>
<tr>
<th>任务</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>计时器</td>
<td>课程组提供实现代码，只需要结合代码和文档理解应用即可</td>
</tr>
<tr>
<td>系统桥</td>
<td>为 CPU 提供统一的访问外设的接口，需要按规格自行实现</td>
</tr>
<tr>
<td>协处理器 CP0</td>
<td>设置 CPU 的异常处理功能，反馈 CPU 的异常信息，需要按规格自行实现</td>
</tr>
<tr>
<td>内部异常检测与流水</td>
<td>CPU 需要具有可以检测内部指令执行错误的能力</td>
</tr>
<tr>
<td>外部中断响应</td>
<td>CPU 需要具有初步响应外部中断信号的能力</td>
</tr>
<tr>
<td>异常处理指令</td>
<td>在异常处理程序中，会有一些特殊的指令需要实现</td>
</tr>
<tr>
<td>单周期 CPU 的封装</td>
<td>让 CPU 从外部看上去是一个单周期 CPU</td>
</tr>
<tr>
<td>异常处理程序</td>
<td>利用 MARS 编写简单的异常处理程序用于测试</td>
</tr>
</tbody></table>
<p><img lazyload="" src="/images/loading.svg" data-src="/../img/MIPS%E5%BE%AE%E7%B3%BB%E7%BB%9F.png" alt="MIPS微系统"></p>
<p>建议：先整体把握所有要做的东西，然后按照外设-&gt;CP0-&gt;异常处理逻辑的顺序较好，主要是为了在写异常之前确认有哪些方向会出异常</p>
<h3 id="计时器tc"><a href="#计时器tc" class="headerlink" title="计时器tc"></a>计时器tc</h3><p>不需要实现，但是需要了解功能与用法</p>
<p>其端口设计相当于多加一个输出中断信号 IRQ 的 DM</p>
<p>内部有 state 和三个寄存器 ctrl、preset、count</p>
<table>
<thead>
<tr>
<th>reg</th>
<th>I/O</th>
<th>function</th>
</tr>
</thead>
<tbody><tr>
<td>ctrl</td>
<td>I/O</td>
<td>[3]:中断使能，[2:1]:模式（mode0：倒数至 0 后持续中断，mode1：循环计数，mode2、3未定义），[0]：计数使能</td>
</tr>
<tr>
<td>present</td>
<td>I/O</td>
<td>初值</td>
</tr>
<tr>
<td>count</td>
<td>O</td>
<td>计数</td>
</tr>
</tbody></table>
<p><img lazyload="" src="/images/loading.svg" data-src="/../img/tc.jpg" alt="tc"></p>
<table>
<thead>
<tr>
<th>state</th>
<th>function</th>
</tr>
</thead>
<tbody><tr>
<td>IDLE</td>
<td>初始状态，不计数</td>
</tr>
<tr>
<td>LOAD</td>
<td>每次开始计数前的准备，将present的数装入count</td>
</tr>
<tr>
<td>CNT</td>
<td>计数状态，ctrl[0] = 1 时有效</td>
</tr>
<tr>
<td>INT</td>
<td>结束状态，若ctrl[2:1] == 0，则产生持续中断信号（mode0），否则开始新一轮计数（mode1）</td>
</tr>
</tbody></table>
<h3 id="系统桥bridge"><a href="#系统桥bridge" class="headerlink" title="系统桥bridge"></a>系统桥bridge</h3><p>该模块需要完成两个功能：</p>
<ol>
<li>联系 CPU 和两个 tc 、以及其他外设</li>
<li>根据访存地址分配相应的存储空间（简单来说就是分辨要读写外设的内存、中断寄存器还是 tc）</li>
</ol>
<p>由于理论上来说 grf 是属于 CPU 的，只是为了评测好像需要与外界相连，因此我们将grf相关信号直接从 CPU 连到 mips 端口，其他则需要按照设计走系统桥</p>
<table>
<thead>
<tr>
<th>def</th>
<th>name</th>
<th>function</th>
</tr>
</thead>
<tbody><tr>
<td>input</td>
<td>interrupt</td>
<td>外部中断信号</td>
</tr>
<tr>
<td>input</td>
<td>IRQ0</td>
<td>tc0中断信号</td>
</tr>
<tr>
<td>input</td>
<td>IRQ1</td>
<td>tc1中断信号</td>
</tr>
<tr>
<td>output[5:0]</td>
<td>HWInt</td>
<td>中断信号</td>
</tr>
<tr>
<td>……</td>
<td>……</td>
<td>……</td>
</tr>
</tbody></table>
<p><strong>定义格式：</strong> 为了区分顶层端口和 cpu，若是 CPU 的数据则在前面加 cpu_ 以作区分</p>
<p>可以看到，bridge为组合逻辑，除了简单的交换数据流，会涉及到 HWInt、访存地址分配</p>
<p>注意：</p>
<ol>
<li>请根据提交要求部分仔细查看相关要求</li>
<li>虽然中断发生器在顶层模块没有读入数据口，但是仍然要实现读取功能（我们规定读出的数据始终保持 0）</li>
<li>Timer0 输出的中断信号接入 HWInt[0] (最低中断位)，Timer1 输出的中断信号接入 HWInt[1]，来自中断发生器的中断信号接入 HWInt[2]</li>
</ol>
<h3 id="CP0"><a href="#CP0" class="headerlink" title="CP0"></a>CP0</h3><p><strong>总要求</strong></p>
<table>
<thead>
<tr>
<th align="left">端口名</th>
<th align="center">方向</th>
<th align="center">位宽</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">clk</td>
<td align="center">IN</td>
<td align="center">1</td>
<td align="left">时钟信号</td>
</tr>
<tr>
<td align="left">reset</td>
<td align="center">IN</td>
<td align="center">1</td>
<td align="left">同步复位信号</td>
</tr>
<tr>
<td align="left">en</td>
<td align="center">IN</td>
<td align="center">1</td>
<td align="left">写使能信号</td>
</tr>
<tr>
<td align="left">CP0Add</td>
<td align="center">IN</td>
<td align="center">5</td>
<td align="left">寄存器地址</td>
</tr>
<tr>
<td align="left">CP0In</td>
<td align="center">IN</td>
<td align="center">32</td>
<td align="left">CP0 写入数据</td>
</tr>
<tr>
<td align="left">CP0Out</td>
<td align="center">OUT</td>
<td align="center">32</td>
<td align="left">CP0 读出数据</td>
</tr>
<tr>
<td align="left">VPC</td>
<td align="center">IN</td>
<td align="center">32</td>
<td align="left">受害 PC</td>
</tr>
<tr>
<td align="left">BDIn</td>
<td align="center">IN</td>
<td align="center">1</td>
<td align="left">是否是延迟槽指令</td>
</tr>
<tr>
<td align="left">ExcCodeIn</td>
<td align="center">IN</td>
<td align="center">5</td>
<td align="left">记录异常类型</td>
</tr>
<tr>
<td align="left">HWInt</td>
<td align="center">IN</td>
<td align="center">6</td>
<td align="left">输入中断信号</td>
</tr>
<tr>
<td align="left">EXLClr</td>
<td align="center">IN</td>
<td align="center">1</td>
<td align="left">用来复位 EXL</td>
</tr>
<tr>
<td align="left">EPCOut</td>
<td align="center">OUT</td>
<td align="center">32</td>
<td align="left">EPC 的值</td>
</tr>
<tr>
<td align="left">Req</td>
<td align="center">OUT</td>
<td align="center">1</td>
<td align="left">进入处理程序请求</td>
</tr>
</tbody></table>
<p>需要实现 SR、Casuse、EPC 三个 CP0 寄存器，会通过 <code>mfc0</code>/<code>mtc0</code> 和异常处理与外界交互</p>
<p>注意：</p>
<ol>
<li>请根据提交要求部分仔细查看相关要求</li>
<li>CP0 寄存器的初始值均为 0，<strong>未实现位始终保持 0</strong></li>
<li>当进入中断或异常状态时，需将 EXL 置为 1；当退出中断或异常状态时，也需将 EXL 置为 0</li>
<li>Cause_IP将会每个周期被修改一次，修改的内容来自计时器和外部中断</li>
<li>测试程序保证不会写入 Cause，但可能写入 SR 和 EPC</li>
</ol>
<p><strong>1. SR（State Register）</strong></p>
<p>功能：配置异常</p>
<p>编号：12</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>15：10</th>
<th>1</th>
<th>0</th>
</tr>
</thead>
<tbody><tr>
<td><strong>域名</strong></td>
<td>IM<br>（Interrupt Mask）</td>
<td>EXL<br>（Exception Level）</td>
<td>IE<br>（Interrupt Enable）</td>
</tr>
<tr>
<td><strong>解释</strong></td>
<td>外部中断使能（按HWInt位）</td>
<td>发生中断异常时置位<br>并禁止中断异常</td>
<td>全局中断使能</td>
</tr>
</tbody></table>
<p><strong>2. Cause</strong></p>
<p>功能：记录异常发生的原因和情况</p>
<p>编号：13</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>31</th>
<th>15：10</th>
<th>6:2</th>
</tr>
</thead>
<tbody><tr>
<td><strong>域名</strong></td>
<td>BD<br>（Branch Delay）</td>
<td>IP<br>（Interrupt Pending）</td>
<td>ExcCode</td>
</tr>
<tr>
<td><strong>解释</strong></td>
<td>延迟槽标识</td>
<td>中断来源</td>
<td>异常编码</td>
</tr>
</tbody></table>
<p><strong>3. EPC</strong></p>
<p>功能：记录异常处理结束后需要返回的 PC</p>
<p>编号：14</p>
<p><strong>4. 外部信号处理</strong></p>
<p>可以发现 CP0Out 和 EPCOut 都是简单的读出数据端口，只需要分析 Req 的实现</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assign</span> Req = (~`EXL &amp;&amp; ((`IE &amp;&amp; (`IM &amp; HWInt)) || (ExcCodeIn)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> CP0Out = register[CP0Add];</span><br><span class="line">	</span><br><span class="line"><span class="keyword">assign</span> EPCOut = EPC;</span><br></pre></td></tr></table></figure></div>

<p>首先 EXL 需为 0 ，也即当前未处于中断异常处理状态，然后分中断和异常两种即可</p>
<p><strong>5. 内部寄存器逻辑</strong></p>
<p>按照以下优先级进行：</p>
<p>（1）reset 复位<br>（2）Req 中断异常请求<br>（3）写入寄存器、EXLClr</p>
<p>注意：IP是每个周期被修改一次，EXLClr 原理上不会和 Req 、load 同时发生</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span> ; i &lt; <span class="number">32</span> ; i = i + <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">			register[i] &lt;= <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">		<span class="keyword">if</span> (Req) <span class="keyword">begin</span></span><br><span class="line">			`EXL 		&lt;= <span class="number">1</span>;</span><br><span class="line">			`BD 		&lt;= BDIn;</span><br><span class="line">			`ExcCode	&lt;= (`IE &amp;&amp; (`IM &amp; HWInt)) ? <span class="number">0</span> : ExcCodeIn;</span><br><span class="line">			`EPC 		&lt;= (BDIn) ? (VPC - <span class="number">32'd4</span>) : VPC;</span><br><span class="line">		<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">			<span class="keyword">if</span> (EXLClr) <span class="keyword">begin</span></span><br><span class="line">				`EXL &lt;= <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">end</span></span><br><span class="line">			<span class="keyword">if</span> (en) <span class="keyword">begin</span></span><br><span class="line">				register[CP0Add] &lt;= load;</span><br><span class="line">			<span class="keyword">end</span></span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">		`IP &lt;= HWInt;</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></div>

<p><strong>6. 添加mfc0、mtc0</strong></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/../img/mfc0.png" alt="mfc0"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/../img/mtc0.png" alt="mtc0"></p>
<p>这里尤其需要注意格式</p>
<h3 id="异常响应机制"><a href="#异常响应机制" class="headerlink" title="异常响应机制"></a>异常响应机制</h3><p><a href="#%E5%BC%82%E5%B8%B8%E7%A0%81">异常码</a></p>
<p>注意：</p>
<ol>
<li>分支跳转指令无论跳转与否，延迟槽指令为受害指令时 BD 均需要置位</li>
<li>发生取指异常或 RI 异常后视为 nop 直至提交到 CP0</li>
<li>跳转到不对齐的地址时，需要向 EPC 写入不对齐的地址</li>
<li>对于未知指令的判断<strong>仅需考虑 opcode（和 R 型指令的 funct）</strong>，且仅需判断是否出现在 <strong>P7 要求的指令集</strong>中，同时保证未知指令的测试用例中 opcode 和 funct 码的组合<strong>一定没有在 MARS 的基本指令集中出现</strong>。</li>
<li>异常信号 ExcCode 应该流水到 CP0 所在的流水级，而不能直接提交到 CP0</li>
</ol>
<p>我们将 CP0 设置在 M 级</p>
<p>注意：如果拖到 M 级判断地址是否非法，需要进行调整防止异常指令修改外设</p>
<table>
<thead>
<tr>
<th>阶段</th>
<th>可能发生的异常</th>
</tr>
</thead>
<tbody><tr>
<td>F</td>
<td>取指异常(4)</td>
</tr>
<tr>
<td>D</td>
<td>系统调用(8),未知指令(10)</td>
</tr>
<tr>
<td>E</td>
<td>取数异常(4,计算地址时加法溢出)<br>取数异常(4,地址非法)<br>存数异常(5,计算地址时加法溢出)<br>存数异常(5,地址非法)<br>溢出异常(12)</td>
</tr>
</tbody></table>
<h3 id="处理外部中断"><a href="#处理外部中断" class="headerlink" title="处理外部中断"></a>处理外部中断</h3><h3 id="进入异常处理程序"><a href="#进入异常处理程序" class="headerlink" title="进入异常处理程序"></a>进入异常处理程序</h3><h3 id="返回现场"><a href="#返回现场" class="headerlink" title="返回现场"></a>返回现场</h3><h3 id="其他注意事项"><a href="#其他注意事项" class="headerlink" title="其他注意事项"></a>其他注意事项</h3><p><strong>对于乘除槽的处理</strong></p>
<p>在进入中断或异常状态时，如果受害指令及其后续指令已经改变了 MDU 的状态，则无需恢复。假设 CP0 在 M 级，MDU 在 E 级，考虑以下情况：</p>
<ul>
<li>mult 在 E 级启动了乘法运算，流水到 M 级时产生了中断，此时无需停止乘法计算，其它乘除法指令同理。</li>
<li>mthi 在 E 级修改了 HI 寄存器，流水到 M 级时产生了中断，此时无需恢复 HI 寄存器的值，mtlo 同理。</li>
<li>mult 在 E 级，受害指令在 M 级，此时还未改变 MDU 状态，不应开始乘法计算，其它乘除法指令同理。</li>
<li>mthi 在 E 级，受害指令在 M 级，此时还未改变 MDU 状态，不应修改 HI 寄存器的值，mtlo 同理。</li>
</ul>
<p>总的来说，由于我的设计是 CP0 放在 M 级，所以以乘除指令到达 M 级为准，如果是在此之前产生的，则不应该让乘除槽产生影响，否则无需回溯</p>
<p>实现的方法就是向乘除槽传入 <code>Req</code> ，当 <code>Req</code> 为 1 时，<strong>不执行乘除指令</strong>，但是可以允许倒数</p>
<p>这里我原来写的是如果 <code>count == 0 &amp;&amp; Req == 0</code> 就执行乘除指令，否则倒数，这会产生<code>Your register outputs are too few.It's also possible that TLE happened.</code>的错误</p>
<p>分析：count为 0 ，Req 为 1 时， count 会因为 Req 变成负数（不为0），然后就一直阻塞相关乘除指令，产生 TLE</p>
<h2 id="测试方案"><a href="#测试方案" class="headerlink" title="测试方案"></a>测试方案</h2><p>利用 Mars 生成对拍程序，可以查看<a href="#handler">handler</a></p>
<p>补充 nop 程序：</p>
<div class="code-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">"nop.txt"</span>,<span class="string">"w"</span>,stdout);</span><br><span class="line">	<span class="type">int</span> instrNum;</span><br><span class="line">	cin&gt;&gt;instrNum;		<span class="comment">//已有指令数 </span></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">1120</span> - instrNum ; ++i) {<span class="built_in">printf</span>(<span class="string">"nop\n"</span>);}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">} </span><br></pre></td></tr></table></figure></div>

<h2 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h2><h3 id="1、思考题1"><a href="#1、思考题1" class="headerlink" title="1、思考题1"></a>1、思考题1</h3><blockquote>
<p>请查阅相关资料，说明鼠标和键盘的输入信号是如何被 CPU 知晓的？</p>
</blockquote>
<p>用户操作 、 硬件产生信号 、控制器发送中断 、CPU 暂停并在中断表中找到处理函数、操作系统驱动读取数据、转化为软件消息</p>
<h3 id="2、思考题2"><a href="#2、思考题2" class="headerlink" title="2、思考题2"></a>2、思考题2</h3><blockquote>
<p>请思考为什么我们的 CPU 处理中断异常必须是已经指定好的地址？如果你的 CPU 支持用户自定义入口地址，即处理中断异常的程序由用户提供，其还能提供我们所希望的功能吗？如果可以，请说明这样可能会出现什么问题？否则举例说明。（假设用户提供的中断处理程序合法）</p>
</blockquote>
<p>CPU 处理中断必须使用指定好（由操作系统内核在启动时写入 IDT/IVT）的地址，中断是硬件对软件的强制调用。如果这个“强制调用”的目标地址可以由用户随意指定，那么恶意软件可以瞬间获得最高权限，任何程序都能窃听全局输入，恶意或错误的程序可以劫持调度机制，独占机器。</p>
<h3 id="3、思考题3"><a href="#3、思考题3" class="headerlink" title="3、思考题3"></a>3、思考题3</h3><blockquote>
<p>为何与外设通信需要 Bridge？</p>
</blockquote>
<p>为了让昂贵且高速的 CPU 能够专注于计算，而将繁杂、低速、多样化的沟通工作外包出去，从而实现整个系统的高效协作</p>
<h3 id="4、思考题4"><a href="#4、思考题4" class="headerlink" title="4、思考题4"></a>4、思考题4</h3><blockquote>
<p>请阅读官方提供的定时器源代码，阐述两种中断模式的异同，并分别针对每一种模式绘制状态移图。</p>
</blockquote>
<p>mode0:持续，mode1：循环</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/../img/tc.jpg" alt="tc"></p>
<h3 id="5、思考题5"><a href="#5、思考题5" class="headerlink" title="5、思考题5"></a>5、思考题5</h3><blockquote>
<p>倘若中断信号流入的时候，在检测宏观 PC 的一级如果是一条空泡（你的 CPU 该级所有信息均为空）指令，此时会发生什么问题？在此例基础上请思考：在 P7 中，清空流水线产生的空泡指令应该保留原指令的哪些信息？</p>
</blockquote>
<p>宏观 PC 检测到空泡的问题：如果气泡全空（PC=0），会导致中断返回地址（EPC）为 0，程序崩溃；如果丢失 BD 信息，会导致中断返回后无法重新跳转，程序逻辑错误。</p>
<p>气泡必须携带的信息：PC 值（该时间片对应的指令地址），BD 状态（该时间片是否处于延迟槽中</p>
<h3 id="6、思考题6"><a href="#6、思考题6" class="headerlink" title="6、思考题6"></a>6、思考题6</h3><blockquote>
<p>为什么 jalr 指令为什么不能写成 jalr <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="2.891ex" height="1.946ex" role="img" focusable="false" viewBox="0 -666 1278 860"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(1000,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g></g></g></svg></mjx-container>31？</p>
</blockquote>
<p>硬件规范禁止：MIPS 标准规定若 rs=rd，结果不可预测（可能导致跳转到下一条指令而不是目标地址）。<br>数据冒险：容易愚弄流水线的前递逻辑。<br>逻辑自杀：在保存旧的返回地址之前就将其覆盖，导致无法正确返回上一级函数</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="异常码"><a href="#异常码" class="headerlink" title="异常码"></a>异常码</h3><table>
<thead>
<tr>
<th align="center">异常码</th>
<th align="left">助记符与名称</th>
<th align="left">指令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>0</strong></td>
<td align="left"><strong>Int</strong><br>（外部中断）</td>
<td align="left">所有指令</td>
<td align="left">中断请求，来源于计时器与外部中断</td>
</tr>
<tr>
<td align="center"><strong>4</strong></td>
<td align="left"><strong>AdEL</strong><br>（取指异常）</td>
<td align="left">所有指令</td>
<td align="left">PC 地址未字对齐<br>PC 地址超过 0x3000 ~ 0x6ffc</td>
</tr>
<tr>
<td align="center"><strong>4</strong></td>
<td align="left"><strong>AdEL</strong><br>（取数异常）</td>
<td align="left">lw</td>
<td align="left">取数地址未与 4 字节对齐</td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
<td align="left">lh</td>
<td align="left">取数地址未与 2 字节对齐</td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
<td align="left">lh, lb</td>
<td align="left">取 Timer 寄存器的值</td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
<td align="left">load 型指令</td>
<td align="left">计算地址时加法溢出</td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
<td align="left">load 型指令</td>
<td align="left">取数地址超出 DM、Timer0、Timer1、中断发生器的范围</td>
</tr>
<tr>
<td align="center"><strong>5</strong></td>
<td align="left"><strong>AdES</strong><br>（存数异常）</td>
<td align="left">sw</td>
<td align="left">存数地址未 4 字节对齐</td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
<td align="left">sh</td>
<td align="left">存数地址未 2 字节对齐</td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
<td align="left">sh, sb</td>
<td align="left">存 Timer 寄存器的值</td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
<td align="left">store 型指令</td>
<td align="left">计算地址加法溢出</td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
<td align="left">store 型指令</td>
<td align="left">向计时器的 Count 寄存器存值</td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
<td align="left">store 型指令</td>
<td align="left">存数地址超出 DM、Timer0、Timer1、中断发生器的范围</td>
</tr>
<tr>
<td align="center"><strong>8</strong></td>
<td align="left"><strong>Syscall</strong><br>（系统调用）</td>
<td align="left">syscall</td>
<td align="left">系统调用</td>
</tr>
<tr>
<td align="center"><strong>10</strong></td>
<td align="left"><strong>RI</strong><br>（未知指令）</td>
<td align="left">-</td>
<td align="left">未知的指令码</td>
</tr>
<tr>
<td align="center"><strong>12</strong></td>
<td align="left"><strong>Ov</strong><br>（溢出异常）</td>
<td align="left">add, addi, sub</td>
<td align="left">算术溢出</td>
</tr>
</tbody></table>
<h3 id="handler"><a href="#handler" class="headerlink" title="handler"></a>handler</h3><div class="code-container" data-rel="Mips"><figure class="iseeu highlight mips"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">_entry:</span></span><br><span class="line">    <span class="comment"># 保存上下文</span></span><br><span class="line">    <span class="keyword">beq </span>$<span class="number">0</span>,$<span class="number">0</span>, _save_context</span><br><span class="line">    <span class="keyword">nop</span></span><br><span class="line"><span class="keyword"></span><span class="symbol"></span></span><br><span class="line"><span class="symbol">_main_handler:</span></span><br><span class="line">    <span class="comment"># 取出 ExcCode</span></span><br><span class="line">    <span class="keyword">mfc0 </span>$<span class="built_in">k0</span>, $<span class="number">13</span></span><br><span class="line">    <span class="keyword">ori </span>$<span class="built_in">k1</span>, $<span class="number">0</span>, <span class="number">0x7c</span></span><br><span class="line">    <span class="keyword">and </span>$<span class="built_in">k0</span>, $<span class="built_in">k0</span>, $<span class="built_in">k1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果是中断，直接恢复上下文</span></span><br><span class="line">    <span class="keyword">beq </span>$<span class="built_in">k0</span>, $<span class="number">0</span>, _restore_context</span><br><span class="line">    <span class="keyword">add </span>$<span class="built_in">t0</span>,$<span class="built_in">k0</span>,$<span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果取指地址超出范围，则直接结束</span></span><br><span class="line">    <span class="keyword">mfc0 </span>$<span class="built_in">k0</span>, $<span class="number">14</span></span><br><span class="line">    <span class="keyword">ori </span>$<span class="built_in">k1</span>, $<span class="number">0</span>, <span class="number">0x3000</span></span><br><span class="line">    <span class="keyword">slt </span>$<span class="built_in">k0</span>, $<span class="built_in">k0</span>, $<span class="built_in">k1</span></span><br><span class="line">    <span class="keyword">bne </span>$<span class="built_in">k0</span>, $<span class="number">0</span> , <span class="keyword">InstructionErrorEnd</span></span><br><span class="line"><span class="keyword"></span>    <span class="keyword">add </span>$<span class="built_in">t0</span>,$<span class="built_in">k0</span>,$<span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mfc0 </span>$<span class="built_in">k0</span>, $<span class="number">14</span></span><br><span class="line">    <span class="keyword">ori </span>$<span class="built_in">k1</span>, $<span class="number">0</span>, <span class="number">0x6FFF</span></span><br><span class="line">    <span class="keyword">slt </span>$<span class="built_in">k0</span>, $<span class="built_in">k1</span>, $<span class="built_in">k0</span></span><br><span class="line">    <span class="keyword">bne </span>$<span class="built_in">k0</span>, $<span class="number">0</span> , <span class="keyword">InstructionErrorEnd</span></span><br><span class="line"><span class="keyword"></span>    <span class="keyword">add </span>$<span class="built_in">t0</span>,$<span class="built_in">k0</span>,$<span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果取指地址不被 4 整除，则恢复</span></span><br><span class="line">    <span class="keyword">mfc0 </span>$<span class="built_in">k0</span>, $<span class="number">14</span></span><br><span class="line">    <span class="keyword">ori </span>$<span class="built_in">k1</span>, $<span class="number">0</span>, <span class="number">0x0003</span></span><br><span class="line">    <span class="keyword">and </span>$<span class="built_in">k1</span>, $<span class="built_in">k0</span>, $<span class="built_in">k1</span></span><br><span class="line">    <span class="keyword">beq </span>$<span class="built_in">k1</span>, $<span class="number">0</span>, skip_nowPC</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">andi </span>$<span class="built_in">k0</span>, $<span class="built_in">k0</span>, <span class="number">0xfffc</span></span><br><span class="line">    <span class="keyword">addi </span>$<span class="built_in">k0</span>, $<span class="built_in">k0</span>, <span class="number">4</span></span><br><span class="line">    <span class="keyword">mtc0 </span>$<span class="built_in">k0</span>, $<span class="number">14</span></span><br><span class="line">    <span class="keyword">beq </span>$<span class="number">0</span>,$<span class="number">0</span>, _restore_context</span><br><span class="line">    <span class="keyword">add </span>$<span class="built_in">t0</span>,$<span class="built_in">k0</span>,$<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将 EPC + 4，即处理异常的方法就是跳过当前指令</span></span><br><span class="line"><span class="symbol">    skip_nowPC:</span></span><br><span class="line">    <span class="keyword">mfc0 </span>$<span class="built_in">k0</span>, $<span class="number">14</span></span><br><span class="line">    <span class="keyword">addu </span>$<span class="built_in">k0</span>, $<span class="built_in">k0</span>, <span class="number">4</span></span><br><span class="line">    <span class="keyword">mtc0 </span>$<span class="built_in">k0</span>, $<span class="number">14</span></span><br><span class="line">    <span class="keyword">beq </span>$<span class="number">0</span>,$<span class="number">0</span>, _restore_context</span><br><span class="line">    <span class="keyword">add </span>$<span class="built_in">t0</span>,$<span class="built_in">k0</span>,$<span class="number">0</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">_exception_return:</span></span><br><span class="line">    <span class="keyword">eret</span></span><br><span class="line"><span class="keyword"></span>    <span class="keyword">add </span>$<span class="built_in">k0</span>,$<span class="built_in">k0</span>,$<span class="number">0</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">_save_context:</span></span><br><span class="line">    <span class="keyword">ori </span>$<span class="built_in">k0</span>, $<span class="number">0</span>, <span class="number">0x1000</span>     <span class="comment"># 在栈上找一块空间保存现场</span></span><br><span class="line">    <span class="keyword">addiu </span>$<span class="built_in">k0</span>, $<span class="built_in">k0</span>, -<span class="number">256</span></span><br><span class="line">    <span class="keyword">sw </span>$<span class="built_in">sp</span>, <span class="number">116</span>($<span class="built_in">k0</span>)        <span class="comment"># 最先保存栈指针</span></span><br><span class="line">    <span class="keyword">move </span>$<span class="built_in">sp</span>, $<span class="built_in">k0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 依次保存通用寄存器（注意要跳过 $sp）、HI 和 LO</span></span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">1</span>, <span class="number">4</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">2</span>, <span class="number">8</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">3</span>, <span class="number">12</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">4</span>, <span class="number">16</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">5</span>, <span class="number">20</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">6</span>, <span class="number">24</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">7</span>, <span class="number">28</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">8</span>, <span class="number">32</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">9</span>, <span class="number">36</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">10</span>, <span class="number">40</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">11</span>, <span class="number">44</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">12</span>, <span class="number">48</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">13</span>, <span class="number">52</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">14</span>, <span class="number">56</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">15</span>, <span class="number">60</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">16</span>, <span class="number">64</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">17</span>, <span class="number">68</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">18</span>, <span class="number">72</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">19</span>, <span class="number">76</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">20</span>, <span class="number">80</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">21</span>, <span class="number">84</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">22</span>, <span class="number">88</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">23</span>, <span class="number">92</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">24</span>, <span class="number">96</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">25</span>, <span class="number">100</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">26</span>, <span class="number">104</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">27</span>, <span class="number">108</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">28</span>, <span class="number">112</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="comment"># 跳过 $sp</span></span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">30</span>, <span class="number">120</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">31</span>, <span class="number">124</span>($<span class="built_in">sp</span>)    </span><br><span class="line">    <span class="keyword">sw </span>$<span class="number">31</span>, <span class="number">124</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">mfhi </span>$<span class="built_in">k0</span></span><br><span class="line">    <span class="keyword">mflo </span>$<span class="built_in">k1</span></span><br><span class="line">    <span class="keyword">sw </span>$<span class="built_in">k0</span>, <span class="number">128</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">sw </span>$<span class="built_in">k1</span>, <span class="number">132</span>($<span class="built_in">sp</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">beq </span>$<span class="number">0</span>,$<span class="number">0</span>, _main_handler</span><br><span class="line">    <span class="keyword">add </span>$<span class="built_in">k0</span>,$<span class="built_in">k0</span>,$<span class="number">0</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">_restore_context:</span></span><br><span class="line">    <span class="comment"># 依次恢复通用寄存器（注意要跳过 $sp）、 HI 和 LO</span></span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">1</span>, <span class="number">4</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">2</span>, <span class="number">8</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">3</span>, <span class="number">12</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">4</span>, <span class="number">16</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">5</span>, <span class="number">20</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">6</span>, <span class="number">24</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">7</span>, <span class="number">28</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">8</span>, <span class="number">32</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">9</span>, <span class="number">36</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">10</span>, <span class="number">40</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">11</span>, <span class="number">44</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">12</span>, <span class="number">48</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">13</span>, <span class="number">52</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">14</span>, <span class="number">56</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">15</span>, <span class="number">60</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">16</span>, <span class="number">64</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">17</span>, <span class="number">68</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">18</span>, <span class="number">72</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">19</span>, <span class="number">76</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">20</span>, <span class="number">80</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">21</span>, <span class="number">84</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">22</span>, <span class="number">88</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">23</span>, <span class="number">92</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">24</span>, <span class="number">96</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">25</span>, <span class="number">100</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">26</span>, <span class="number">104</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">27</span>, <span class="number">108</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">28</span>, <span class="number">112</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="comment"># 跳过 $sp</span></span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">30</span>, <span class="number">120</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="number">31</span>, <span class="number">124</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="built_in">k0</span>, <span class="number">128</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">lw </span>$<span class="built_in">k1</span>, <span class="number">132</span>($<span class="built_in">sp</span>)</span><br><span class="line">    <span class="keyword">mthi </span>$<span class="built_in">k0</span></span><br><span class="line">    <span class="keyword">mtlo </span>$<span class="built_in">k1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 最后恢复栈指针</span></span><br><span class="line">    <span class="keyword">lw </span>$<span class="built_in">sp</span>, <span class="number">116</span>($<span class="built_in">sp</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">beq </span>$<span class="number">0</span>,$<span class="number">0</span>, _exception_return</span><br><span class="line">    <span class="keyword">add </span>$<span class="built_in">k0</span>,$<span class="built_in">k0</span>,$<span class="number">0</span></span><br><span class="line"><span class="symbol">    </span></span><br><span class="line"><span class="symbol">InstructionErrorEnd:</span><span class="keyword">beq </span>$<span class="number">0</span>,$<span class="number">0</span>,<span class="keyword">InstructionErrorEnd</span></span><br></pre></td></tr></table></figure></div>
		</div>

		
		<div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
			<div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> 计组P7——流水线CPU（复杂指令集&amp;支持异常处理）</li>
        <li><strong>Author:</strong> rippor</li>
        <li><strong>Created at
                :</strong> 2025-12-02 10:12:46</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2025-12-15 22:20:25
            </li>
        
        <li>
            <strong>Link:</strong> https://redefine.ohevan.com/2025/12/02/COP7/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

		</div>
		

		
		<ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
			
			<li class="tag-item mx-0.5">
				<a href="/tags/Verilog/">#Verilog</a>&nbsp;
			</li>
			
			<li class="tag-item mx-0.5">
				<a href="/tags/%E4%BA%94%E5%B1%82%E6%B5%81%E6%B0%B4%E7%BA%BFCPU/">#五层流水线CPU</a>&nbsp;
			</li>
			
		</ul>
		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/2025/12/02/CO/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item truncate max-w-48">计组理论</span>
						<span class="post-nav-item">Prev posts</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2025/11/29/machine-learning/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item truncate max-w-48">机器学习</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
		<div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
			<div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          dark: 'body[class~="dark-mode"]',
          reaction: false,
          requiredMeta: ['nick', 'mail'],
          emoji: [],
                    lang: 'zh-CN',
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

		</div>
		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">计组P7——流水线CPU（复杂指令集&amp;支持异常处理）</div>
		<ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8A%E7%BA%A7%E6%97%A5%E8%AE%B0"><span class="nav-text">上级日记</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E8%8D%89%E7%A8%BF"><span class="nav-text">设计草稿</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E6%97%B6%E5%99%A8tc"><span class="nav-text">计时器tc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%A1%A5bridge"><span class="nav-text">系统桥bridge</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CP0"><span class="nav-text">CP0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%93%8D%E5%BA%94%E6%9C%BA%E5%88%B6"><span class="nav-text">异常响应机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD"><span class="nav-text">处理外部中断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9B%E5%85%A5%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="nav-text">进入异常处理程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E7%8E%B0%E5%9C%BA"><span class="nav-text">返回现场</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">其他注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%A1%88"><span class="nav-text">测试方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%9D%E8%80%83%E9%A2%98"><span class="nav-text">思考题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E6%80%9D%E8%80%83%E9%A2%981"><span class="nav-text">1、思考题1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%80%9D%E8%80%83%E9%A2%982"><span class="nav-text">2、思考题2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E6%80%9D%E8%80%83%E9%A2%983"><span class="nav-text">3、思考题3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E6%80%9D%E8%80%83%E9%A2%984"><span class="nav-text">4、思考题4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E6%80%9D%E8%80%83%E9%A2%985"><span class="nav-text">5、思考题5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81%E6%80%9D%E8%80%83%E9%A2%986"><span class="nav-text">6、思考题6</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%99%84%E5%BD%95"><span class="nav-text">附录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E7%A0%81"><span class="nav-text">异常码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#handler"><span class="nav-text">handler</span></a></li></ol></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2025</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-volleyball fa-bounce"></i>&nbsp;&nbsp;<a href="/">rippor</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        13 posts in total
                    </span>
                    
                        <span>
                            27.2k words in total
                        </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.5</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
		<li class="go-comment">
			<i class="fa-regular fa-comments"></i>
		</li>
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	
	<div class="search-pop-overlay">
	<div class="popup search-popup">
		<div class="search-header">
			<span class="search-input-field-pre">
				<i class="fa-solid fa-keyboard"></i>
			</span>
			<div class="search-input-container">
				<input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
			</div>
			<span class="popup-btn-close">
				<i class="fa-solid fa-times"></i>
			</span>
		</div>
		<div id="search-result">
			<div id="no-result">
				<i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
			</div>
		</div>
	</div>
</div>
	

</main>



<script src="/js/build/libs/Swup.min.js"></script>

<script src="/js/build/libs/SwupSlideTheme.min.js"></script>

<script src="/js/build/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/build/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/build/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/build/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	
<script src="/js/build/tools/imageViewer.js" type="module"></script>

<script src="/js/build/utils.js" type="module"></script>

<script src="/js/build/main.js" type="module"></script>

<script src="/js/build/layouts/navbarShrink.js" type="module"></script>

<script src="/js/build/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/build/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/build/layouts/categoryList.js" type="module"></script>



    
<script src="/js/build/tools/localSearch.js" type="module"></script>




    
<script src="/js/build/tools/codeBlock.js" type="module"></script>




    
<script src="/js/build/layouts/lazyload.js" type="module"></script>




    
<script src="/js/build/tools/runtime.js"></script>

    
<script src="/js/build/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/build/libs/Typed.min.js"></script>

  
<script src="/js/build/plugins/typed.js" type="module"></script>




    
        <script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js"></script>
    
    
<script src="/js/build/plugins/mermaid.js"></script>




    
<script src="/js/build/libs/minimasonry.min.js"></script>

    
<script src="/js/build/plugins/masonry.js" type="module"></script>




    
<script src="/js/build/libs/anime.min.js"></script>





    
<script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script>




<script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script>


<script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script>





	
	<div id="aplayer"></div>

<script src="/js/build/libs/APlayer.min.js"></script>


<script src="/js/build/plugins/aplayer.js"></script>


	
</body>

</html>